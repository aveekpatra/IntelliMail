module.exports = {

"[project]/.next-internal/server/app/api/auth/callback/gmail/route/actions.js [app-rsc] (server actions loader, ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({});
}}),
"[externals]/next/dist/compiled/next-server/app-route.runtime.dev.js [external] (next/dist/compiled/next-server/app-route.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/@opentelemetry/api [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@opentelemetry/api", () => require("@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page.runtime.dev.js [external] (next/dist/compiled/next-server/app-page.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/child_process [external] (child_process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("child_process", () => require("child_process"));

module.exports = mod;
}}),
"[externals]/fs [external] (fs, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("fs", () => require("fs"));

module.exports = mod;
}}),
"[externals]/os [external] (os, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("os", () => require("os"));

module.exports = mod;
}}),
"[externals]/net [external] (net, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("net", () => require("net"));

module.exports = mod;
}}),
"[externals]/tls [external] (tls, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tls", () => require("tls"));

module.exports = mod;
}}),
"[externals]/assert [external] (assert, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("assert", () => require("assert"));

module.exports = mod;
}}),
"[externals]/tty [external] (tty, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("tty", () => require("tty"));

module.exports = mod;
}}),
"[externals]/util [external] (util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("util", () => require("util"));

module.exports = mod;
}}),
"[externals]/http [external] (http, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http", () => require("http"));

module.exports = mod;
}}),
"[externals]/https [external] (https, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("https", () => require("https"));

module.exports = mod;
}}),
"[externals]/url [external] (url, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("url", () => require("url"));

module.exports = mod;
}}),
"[externals]/stream [external] (stream, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("stream", () => require("stream"));

module.exports = mod;
}}),
"[externals]/punycode [external] (punycode, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("punycode", () => require("punycode"));

module.exports = mod;
}}),
"[externals]/zlib [external] (zlib, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("zlib", () => require("zlib"));

module.exports = mod;
}}),
"[externals]/querystring [external] (querystring, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("querystring", () => require("querystring"));

module.exports = mod;
}}),
"[externals]/crypto [external] (crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("crypto", () => require("crypto"));

module.exports = mod;
}}),
"[externals]/node:events [external] (node:events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:events", () => require("node:events"));

module.exports = mod;
}}),
"[externals]/node:process [external] (node:process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:process", () => require("node:process"));

module.exports = mod;
}}),
"[externals]/node:util [external] (node:util, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:util", () => require("node:util"));

module.exports = mod;
}}),
"[externals]/path [external] (path, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("path", () => require("path"));

module.exports = mod;
}}),
"[externals]/buffer [external] (buffer, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("buffer", () => require("buffer"));

module.exports = mod;
}}),
"[externals]/events [external] (events, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("events", () => require("events"));

module.exports = mod;
}}),
"[externals]/http2 [external] (http2, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("http2", () => require("http2"));

module.exports = mod;
}}),
"[externals]/process [external] (process, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("process", () => require("process"));

module.exports = mod;
}}),
"[externals]/node:crypto [external] (node:crypto, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("node:crypto", () => require("node:crypto"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/action-async-storage.external.js [external] (next/dist/server/app-render/action-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/action-async-storage.external.js", () => require("next/dist/server/app-render/action-async-storage.external.js"));

module.exports = mod;
}}),
"[project]/src/lib/stripe.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "stripe": (()=>stripe)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$stripe$2f$esm$2f$stripe$2e$esm$2e$node$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/stripe/esm/stripe.esm.node.js [app-route] (ecmascript)");
'server-only';
;
const stripe = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$stripe$2f$esm$2f$stripe$2e$esm$2e$node$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"](process.env.STRIPE_SECRET_KEY, {
    apiVersion: '2024-06-20'
});
}}),
"[externals]/@prisma/client [external] (@prisma/client, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@prisma/client", () => require("@prisma/client"));

module.exports = mod;
}}),
"[project]/src/env.js [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "env": (()=>env)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$t3$2d$oss$2f$env$2d$nextjs$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@t3-oss/env-nextjs/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/zod/lib/index.mjs [app-route] (ecmascript)");
;
;
const env = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$t3$2d$oss$2f$env$2d$nextjs$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createEnv"])({
    /**
   * Specify your server-side environment variables schema here. This way you can ensure the app
   * isn't built with invalid env vars.
   */ server: {
        DATABASE_URL: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].string().url(),
        NODE_ENV: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$zod$2f$lib$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["z"].enum([
            "development",
            "test",
            "production"
        ]).default("development")
    },
    /**
   * Specify your client-side environment variables schema here. This way you can ensure the app
   * isn't built with invalid env vars. To expose them to the client, prefix them with
   * `NEXT_PUBLIC_`.
   */ client: {
    },
    /**
   * You can't destruct `process.env` as a regular object in the Next.js edge runtimes (e.g.
   * middlewares) or client-side so we need to destruct manually.
   */ runtimeEnv: {
        DATABASE_URL: process.env.DATABASE_URL,
        NODE_ENV: ("TURBOPACK compile-time value", "development")
    },
    /**
   * Run `build` or `dev` with `SKIP_ENV_VALIDATION` to skip env validation. This is especially
   * useful for Docker builds.
   */ skipValidation: !!process.env.SKIP_ENV_VALIDATION,
    /**
   * Makes it so that empty strings are treated as undefined. `SOME_VAR: z.string()` and
   * `SOME_VAR=''` will throw an error.
   */ emptyStringAsUndefined: true
});
}}),
"[project]/src/server/db.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "db": (()=>db)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/@prisma/client [external] (@prisma/client, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$env$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/env.js [app-route] (ecmascript)");
;
;
const createPrismaClient = ()=>new __TURBOPACK__imported__module__$5b$externals$5d2f40$prisma$2f$client__$5b$external$5d$__$2840$prisma$2f$client$2c$__cjs$29$__["PrismaClient"]({
        log: __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$env$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["env"].NODE_ENV === "development" ? [
            "error",
            "warn"
        ] : [
            "error"
        ]
    });
const globalForPrisma = globalThis;
const db = globalForPrisma.prisma ?? createPrismaClient();
if (__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$env$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["env"].NODE_ENV !== "production") globalForPrisma.prisma = db;
}}),
"[project]/src/lib/stripe-actions.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ {"0038dcec4b98008d715954750b1aa11e2197b0e915":"getSubscriptionStatus","008122952772ffdae7f8b9689e00657b0a630c9571":"createBillingPortalSession","00d100fbf792f21c2c309b774432e8a2a20f1a73b1":"createCheckoutSession"} */ __turbopack_context__.s({
    "createBillingPortalSession": (()=>createBillingPortalSession),
    "createCheckoutSession": (()=>createCheckoutSession),
    "getSubscriptionStatus": (()=>getSubscriptionStatus)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$clerk$2f$nextjs$2f$dist$2f$esm$2f$app$2d$router$2f$server$2f$auth$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@clerk/nextjs/dist/esm/app-router/server/auth.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$stripe$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/stripe.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$api$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$module__evaluation$3e$__ = __turbopack_context__.i("[project]/node_modules/next/dist/api/navigation.react-server.js [app-route] (ecmascript) <module evaluation>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/client/components/navigation.react-server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/server/db.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-route] (ecmascript)");
;
;
;
;
;
;
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ createCheckoutSession() {
    const { userId } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$clerk$2f$nextjs$2f$dist$2f$esm$2f$app$2d$router$2f$server$2f$auth$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["auth"])();
    if (!userId) {
        throw new Error('User not found');
    }
    const session = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$stripe$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["stripe"].checkout.sessions.create({
        payment_method_types: [
            'card'
        ],
        line_items: [
            {
                price: process.env.STRIPE_PRICE_ID,
                quantity: 1
            }
        ],
        mode: 'subscription',
        success_url: `${("TURBOPACK compile-time value", "http://localhost:3001")}/mail`,
        cancel_url: `${("TURBOPACK compile-time value", "http://localhost:3001")}/pricing`,
        client_reference_id: userId.toString()
    });
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["redirect"])(session.url);
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ createBillingPortalSession() {
    const { userId } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$clerk$2f$nextjs$2f$dist$2f$esm$2f$app$2d$router$2f$server$2f$auth$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["auth"])();
    if (!userId) {
        return false;
    }
    const subscription = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].stripeSubscription.findUnique({
        where: {
            userId: userId
        }
    });
    if (!subscription?.customerId) {
        throw new Error('Subscription not found');
    }
    const session = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$stripe$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["stripe"].billingPortal.sessions.create({
        customer: subscription.customerId,
        return_url: `${("TURBOPACK compile-time value", "http://localhost:3001")}/pricing`
    });
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$client$2f$components$2f$navigation$2e$react$2d$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["redirect"])(session.url);
}
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ getSubscriptionStatus() {
    const { userId } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$clerk$2f$nextjs$2f$dist$2f$esm$2f$app$2d$router$2f$server$2f$auth$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["auth"])();
    if (!userId) {
        return false;
    }
    const subscription = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].stripeSubscription.findUnique({
        where: {
            userId: userId
        }
    });
    if (!subscription) {
        return false;
    }
    return subscription.currentPeriodEnd > new Date();
}
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    createCheckoutSession,
    createBillingPortalSession,
    getSubscriptionStatus
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(createCheckoutSession, "00d100fbf792f21c2c309b774432e8a2a20f1a73b1", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(createBillingPortalSession, "008122952772ffdae7f8b9689e00657b0a630c9571", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(getSubscriptionStatus, "0038dcec4b98008d715954750b1aa11e2197b0e915", null);
}}),
"[project]/src/app/constants.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "FREE_ACCOUNTS_PER_USER": (()=>FREE_ACCOUNTS_PER_USER),
    "FREE_CREDITS_PER_DAY": (()=>FREE_CREDITS_PER_DAY),
    "PRO_ACCOUNTS_PER_USER": (()=>PRO_ACCOUNTS_PER_USER)
});
const FREE_CREDITS_PER_DAY = 15;
const FREE_ACCOUNTS_PER_USER = 1;
const PRO_ACCOUNTS_PER_USER = 3;
}}),
"[project]/src/lib/gmail.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ {"60e0892b6c1bd69f12770b84151506cf7e9e1b6b18":"createGmailAccount","7f0a51e9459e744f8374ca86c6219119bbff6231bc":"getGmailTokens","7f295ac5076a92fec22a9400c18ee6e58cff1d8191":"refreshGmailToken","7f664bb80837f6f53695699a0cafa28c178caf835c":"fetchGmailEmails","7f6f4975cfd7867cb73e66a7020dcba96a8eab7865":"getGmailUserInfo","7fb4c53f85c94fb1372c295a82e63f8074da798e2b":"getGmailAuthUrl"} */ __turbopack_context__.s({
    "createGmailAccount": (()=>createGmailAccount),
    "fetchGmailEmails": (()=>fetchGmailEmails),
    "getGmailAuthUrl": (()=>getGmailAuthUrl),
    "getGmailTokens": (()=>getGmailTokens),
    "getGmailUserInfo": (()=>getGmailUserInfo),
    "refreshGmailToken": (()=>refreshGmailToken)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/server-reference.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$server$2f$app$2d$render$2f$encryption$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/server/app-render/encryption.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/googleapis/build/src/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$clerk$2f$nextjs$2f$dist$2f$esm$2f$app$2d$router$2f$server$2f$auth$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@clerk/nextjs/dist/esm/app-router/server/auth.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$stripe$2d$actions$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/stripe-actions.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/server/db.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/app/constants.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-validate.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
// Create OAuth2 client
function getOAuth2Client() {
    console.log("Creating OAuth2 client with credentials...");
    return new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["google"].auth.OAuth2(process.env.GOOGLE_CLIENT_ID, process.env.GOOGLE_CLIENT_SECRET, `${("TURBOPACK compile-time value", "http://localhost:3001")}/api/auth/callback/gmail`);
}
const /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ getGmailAuthUrl = async ()=>{
    try {
        console.log("Starting Gmail auth URL generation...");
        const { userId } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$clerk$2f$nextjs$2f$dist$2f$esm$2f$app$2d$router$2f$server$2f$auth$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["auth"])();
        if (!userId) {
            console.error("No user ID found in auth");
            throw new Error("User not found");
        }
        console.log("Got user ID:", userId);
        const user = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.upsert({
            where: {
                id: userId
            },
            update: {},
            create: {
                id: userId,
                emailAddress: "temp@example.com",
                role: "user"
            }
        });
        console.log("User record created/updated:", user);
        // Check subscription limits
        console.log("Checking subscription limits...");
        const isSubscribed = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$stripe$2d$actions$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSubscriptionStatus"])();
        console.log("Subscription status:", isSubscribed);
        const accounts = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].account.count({
            where: {
                userId
            }
        });
        console.log("Current account count:", accounts);
        console.log("Account limit:", isSubscribed ? __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PRO_ACCOUNTS_PER_USER"] : __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$constants$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["FREE_ACCOUNTS_PER_USER"]);
        // Temporarily disabled account limits
        /*
    if (user.role === "user") {
      if (isSubscribed) {
        if (accounts >= PRO_ACCOUNTS_PER_USER) {
          console.error("User has reached maximum accounts for subscription", {
            currentAccounts: accounts,
            maxAccounts: PRO_ACCOUNTS_PER_USER,
            isSubscribed: true,
          });
          throw new Error(
            "You have reached the maximum number of accounts for your subscription",
          );
        }
      } else {
        if (accounts >= FREE_ACCOUNTS_PER_USER) {
          console.error("User has reached maximum free accounts", {
            currentAccounts: accounts,
            maxAccounts: FREE_ACCOUNTS_PER_USER,
            isSubscribed: false,
          });
          throw new Error(
            "You have reached the maximum number of accounts for your subscription",
          );
        }
      }
    }
    */ console.log("Creating OAuth2 client...");
        const oauth2Client = getOAuth2Client();
        const scopes = [
            "https://www.googleapis.com/auth/gmail.readonly",
            "https://www.googleapis.com/auth/gmail.send",
            "https://www.googleapis.com/auth/gmail.compose",
            "https://www.googleapis.com/auth/gmail.modify",
            "https://www.googleapis.com/auth/userinfo.email",
            "https://www.googleapis.com/auth/userinfo.profile"
        ];
        console.log("Using scopes:", scopes);
        console.log("Generating auth URL with state:", userId);
        const authUrl = oauth2Client.generateAuthUrl({
            access_type: "offline",
            scope: scopes,
            prompt: "consent",
            state: userId,
            include_granted_scopes: true
        });
        console.log("Auth URL generated successfully:", authUrl);
        return authUrl;
    } catch (error) {
        console.error("Error in getGmailAuthUrl:", error);
        if (error instanceof Error) {
            console.error("Error details:", {
                message: error.message,
                stack: error.stack
            });
        }
        throw error;
    }
};
const /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ getGmailTokens = async (code)=>{
    try {
        console.log("Starting token exchange process...");
        console.log("Creating OAuth2 client for token exchange...");
        const oauth2Client = getOAuth2Client();
        console.log("Exchanging code for tokens...");
        const { tokens } = await oauth2Client.getToken(code);
        console.log("Token exchange successful");
        if (!tokens.access_token) {
            console.error("No access token received");
            throw new Error("Failed to get access token");
        }
        console.log("Tokens received:", {
            accessTokenExists: !!tokens.access_token,
            refreshTokenExists: !!tokens.refresh_token,
            expiryDate: tokens.expiry_date
        });
        return {
            accessToken: tokens.access_token,
            refreshToken: tokens.refresh_token,
            expiryDate: tokens.expiry_date
        };
    } catch (error) {
        console.error("Error in getGmailTokens:", error);
        if (error instanceof Error) {
            console.error("Error details:", {
                message: error.message,
                stack: error.stack
            });
        }
        throw error;
    }
};
const /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ getGmailUserInfo = async (accessToken)=>{
    try {
        console.log("Starting user info fetch process...");
        console.log("Setting up OAuth2 client with access token...");
        const oauth2Client = getOAuth2Client();
        oauth2Client.setCredentials({
            access_token: accessToken
        });
        console.log("Creating People API client...");
        const peopleApi = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["google"].people({
            version: "v1",
            auth: oauth2Client
        });
        console.log("Fetching user profile...");
        const profile = await peopleApi.people.get({
            resourceName: "people/me",
            personFields: "emailAddresses,names"
        });
        console.log("User profile fetched successfully");
        const userInfo = {
            email: profile.data.emailAddresses?.[0]?.value || "",
            name: profile.data.names?.[0]?.displayName || ""
        };
        console.log("User info:", userInfo);
        return userInfo;
    } catch (error) {
        console.error("Error in getGmailUserInfo:", error);
        if (error instanceof Error) {
            console.error("Error details:", {
                message: error.message,
                stack: error.stack
            });
        }
        throw error;
    }
};
async function /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ createGmailAccount(accessToken, refreshToken) {
    try {
        console.log("Creating Gmail account with tokens...");
        console.log("Token info:", {
            accessTokenExists: !!accessToken,
            refreshTokenExists: !!refreshToken
        });
        // Implementation for syncing emails and sending
        const gmailAccount = {
            accessToken,
            refreshToken,
            async syncEmails () {
                console.log("Starting email sync process...");
                // Implement email syncing logic here
                return {
                    success: true,
                    count: 0
                };
            },
            async sendEmail (options) {
                console.log("Sending email:", options);
                const oauth2Client = getOAuth2Client();
                oauth2Client.setCredentials({
                    access_token: accessToken
                });
                const gmail = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["google"].gmail({
                    version: "v1",
                    auth: oauth2Client
                });
                // Format the email according to Gmail API requirements
                const message = [
                    `To: ${options.to}`,
                    `Subject: ${options.subject}`,
                    "Content-Type: text/html; charset=utf-8",
                    "",
                    options.body
                ].join("\n");
                const encodedMessage = Buffer.from(message).toString("base64").replace(/\+/g, "-").replace(/\//g, "_").replace(/=+$/, "");
                console.log("Sending email via Gmail API...");
                await gmail.users.messages.send({
                    userId: "me",
                    requestBody: {
                        raw: encodedMessage
                    }
                });
                console.log("Email sent successfully");
                return {
                    success: true
                };
            }
        };
        console.log("Gmail account created successfully");
        return gmailAccount;
    } catch (error) {
        console.error("Error in createGmailAccount:", error);
        if (error instanceof Error) {
            console.error("Error details:", {
                message: error.message,
                stack: error.stack
            });
        }
        throw error;
    }
}
const /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ refreshGmailToken = async (refreshToken)=>{
    try {
        console.log("Starting token refresh process...");
        const oauth2Client = getOAuth2Client();
        console.log("Setting refresh token...");
        oauth2Client.setCredentials({
            refresh_token: refreshToken
        });
        console.log("Refreshing access token...");
        const { credentials } = await oauth2Client.refreshAccessToken();
        console.log("Access token refreshed successfully");
        return {
            accessToken: credentials.access_token,
            expiryDate: credentials.expiry_date
        };
    } catch (error) {
        console.error("Error refreshing Gmail token:", error);
        if (error instanceof Error) {
            console.error("Error details:", {
                message: error.message,
                stack: error.stack
            });
        }
        throw error;
    }
};
const /*#__TURBOPACK_DISABLE_EXPORT_MERGING__*/ fetchGmailEmails = async (accessToken, maxResults = 20, refreshToken)=>{
    try {
        console.log("Starting Gmail email fetch process...");
        console.log("Setting up OAuth2 client with access token...");
        const oauth2Client = getOAuth2Client();
        oauth2Client.setCredentials({
            access_token: accessToken,
            refresh_token: refreshToken || undefined
        });
        console.log("Creating Gmail API client...");
        const gmail = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$googleapis$2f$build$2f$src$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["google"].gmail({
            version: "v1",
            auth: oauth2Client
        });
        console.log("Fetching emails from Gmail API...");
        const response = await gmail.users.messages.list({
            userId: "me",
            maxResults: maxResults,
            q: "in:inbox"
        });
        console.log(`Retrieved ${response.data.messages?.length || 0} email IDs`);
        if (!response.data.messages || response.data.messages.length === 0) {
            console.log("No emails found");
            return [];
        }
        // Get email details for each message ID
        console.log("Fetching email details...");
        const emails = await Promise.all(response.data.messages.map(async (message)=>{
            if (!message.id) return null;
            const emailDetail = await gmail.users.messages.get({
                userId: "me",
                id: message.id
            });
            const headers = emailDetail.data.payload?.headers || [];
            // Extract email headers
            const subject = headers.find((h)=>h.name === "Subject")?.value || "(No subject)";
            const from = headers.find((h)=>h.name === "From")?.value || "";
            const to = headers.find((h)=>h.name === "To")?.value || "";
            const date = headers.find((h)=>h.name === "Date")?.value || "";
            // Extract email body (text or HTML)
            let body = "";
            const parts = emailDetail.data.payload?.parts || [];
            if (parts.length > 0) {
                // Try to find HTML body first
                const htmlPart = parts.find((p)=>p.mimeType === "text/html");
                const textPart = parts.find((p)=>p.mimeType === "text/plain");
                if (htmlPart && htmlPart.body && htmlPart.body.data) {
                    body = Buffer.from(htmlPart.body.data, "base64").toString("utf-8");
                } else if (textPart && textPart.body && textPart.body.data) {
                    body = Buffer.from(textPart.body.data, "base64").toString("utf-8");
                }
            } else if (emailDetail.data.payload?.body?.data) {
                // For single-part messages
                body = Buffer.from(emailDetail.data.payload.body.data, "base64").toString("utf-8");
            }
            // Create a snippet from the body (first 100 chars)
            const snippet = body.substring(0, 100) + (body.length > 100 ? "..." : "");
            return {
                id: message.id,
                threadId: emailDetail.data.threadId,
                labelIds: emailDetail.data.labelIds || [],
                snippet: emailDetail.data.snippet || snippet,
                subject,
                from,
                to,
                date,
                body
            };
        }));
        console.log(`Fetched details for ${emails.filter(Boolean).length} emails`);
        return emails.filter(Boolean);
    } catch (error) {
        console.error("Error in fetchGmailEmails:", error);
        if (error instanceof Error) {
            console.error("Error details:", {
                message: error.message,
                stack: error.stack
            });
        }
        throw error;
    }
};
;
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ensureServerEntryExports"])([
    getGmailAuthUrl,
    getGmailTokens,
    getGmailUserInfo,
    createGmailAccount,
    refreshGmailToken,
    fetchGmailEmails
]);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(getGmailAuthUrl, "7fb4c53f85c94fb1372c295a82e63f8074da798e2b", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(getGmailTokens, "7f0a51e9459e744f8374ca86c6219119bbff6231bc", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(getGmailUserInfo, "7f6f4975cfd7867cb73e66a7020dcba96a8eab7865", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(createGmailAccount, "60e0892b6c1bd69f12770b84151506cf7e9e1b6b18", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(refreshGmailToken, "7f295ac5076a92fec22a9400c18ee6e58cff1d8191", null);
(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$server$2d$reference$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["registerServerReference"])(fetchGmailEmails, "7f664bb80837f6f53695699a0cafa28c178caf835c", null);
}}),
"[project]/src/app/api/auth/callback/gmail/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.s({
    "GET": (()=>GET)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$gmail$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/gmail.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/server/db.ts [app-route] (ecmascript)");
;
;
;
const GET = async (req)=>{
    console.log("[GMAIL CALLBACK] Processing Gmail OAuth callback...");
    try {
        // Get the user ID from the URL state parameter
        const url = new URL(req.url);
        const errorParam = url.searchParams.get("error");
        if (errorParam) {
            console.error("[GMAIL CALLBACK] Auth error from Google:", errorParam);
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].redirect(new URL(`/mail?error=${errorParam}`, req.url));
        }
        // Get the authorization code from the URL
        const code = url.searchParams.get("code");
        if (!code) {
            console.error("[GMAIL CALLBACK] No authorization code provided in callback");
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].redirect(new URL("/mail?error=no_code", req.url));
        }
        console.log("[GMAIL CALLBACK] Received authorization code");
        // Get the user ID from the state parameter
        const userState = url.searchParams.get("state");
        if (!userState) {
            console.error("[GMAIL CALLBACK] No user ID found in state parameter");
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].redirect(new URL("/mail?error=no_user", req.url));
        }
        console.log("[GMAIL CALLBACK] User ID from state:", userState);
        // Get the tokens from the authorization code
        console.log("[GMAIL CALLBACK] Exchanging code for tokens...");
        const tokens = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$gmail$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getGmailTokens"])(code);
        console.log("[GMAIL CALLBACK] Tokens received successfully:", {
            accessTokenLength: tokens.accessToken?.length,
            hasRefreshToken: !!tokens.refreshToken,
            refreshTokenLength: tokens.refreshToken?.length
        });
        // Check if we have a refresh token
        if (!tokens.refreshToken) {
            console.warn("[GMAIL CALLBACK] No refresh token received - this will limit token refresh capabilities");
        }
        // Get the user info
        console.log("[GMAIL CALLBACK] Fetching user info...");
        const userInfo = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$gmail$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getGmailUserInfo"])(tokens.accessToken);
        console.log("[GMAIL CALLBACK] User info fetched:", userInfo);
        // Generate a unique account ID
        const accountId = `gmail_${crypto.randomUUID()}`;
        console.log("[GMAIL CALLBACK] Generated account ID:", accountId);
        // Check if an account with this email already exists
        const existingAccount = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].account.findFirst({
            where: {
                userId: userState,
                emailAddress: userInfo.email,
                provider: "Gmail"
            }
        });
        if (existingAccount) {
            console.log("[GMAIL CALLBACK] Account already exists, updating tokens instead of creating new account");
            // Update the existing account with new tokens
            const updatedAccount = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].account.update({
                where: {
                    id: existingAccount.id
                },
                data: {
                    token: tokens.accessToken,
                    refreshToken: tokens.refreshToken || existingAccount.refreshToken || ""
                }
            });
            console.log("[GMAIL CALLBACK] Account tokens updated successfully:", {
                id: updatedAccount.id,
                email: updatedAccount.emailAddress,
                hasRefreshToken: !!updatedAccount.refreshToken
            });
        } else {
            // Save the account to the database
            console.log("[GMAIL CALLBACK] Creating new account in database...");
            try {
                // Check if user exists in database
                const user = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.findUnique({
                    where: {
                        id: userState
                    }
                });
                if (!user) {
                    console.error("[GMAIL CALLBACK] User not found in database:", userState);
                    // Create user if they don't exist
                    await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].user.create({
                        data: {
                            id: userState,
                            emailAddress: userInfo.email
                        }
                    });
                    console.log("[GMAIL CALLBACK] Created new user in database:", userState);
                }
                const createdAccount = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].account.create({
                    data: {
                        id: accountId,
                        userId: userState,
                        provider: "Gmail",
                        emailAddress: userInfo.email,
                        name: userInfo.name,
                        token: tokens.accessToken,
                        refreshToken: tokens.refreshToken || "",
                        nextDeltaToken: ""
                    }
                });
                console.log("[GMAIL CALLBACK]  GMAIL ACCOUNT CREATED SUCCESSFULLY!", {
                    id: createdAccount.id,
                    email: createdAccount.emailAddress,
                    userId: createdAccount.userId,
                    hasRefreshToken: !!createdAccount.refreshToken
                });
            } catch (dbError) {
                console.error("[GMAIL CALLBACK] Error creating account in database:", dbError);
                console.error("[GMAIL CALLBACK] Account data:", {
                    id: accountId,
                    userId: userState,
                    provider: "Gmail",
                    emailAddress: userInfo.email,
                    name: userInfo.name,
                    tokenLength: tokens.accessToken.length,
                    hasRefreshToken: !!tokens.refreshToken
                });
                throw dbError;
            }
        }
        // Get total Gmail accounts for this user
        const totalGmailAccounts = await __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$server$2f$db$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["db"].account.count({
            where: {
                userId: userState,
                provider: "Gmail"
            }
        });
        console.log(`[GMAIL CALLBACK] User now has ${totalGmailAccounts} Gmail ${totalGmailAccounts === 1 ? "account" : "accounts"} connected.`);
        // Start initial email sync in the background
        console.log("[GMAIL CALLBACK] Starting background initial sync...");
        try {
            const syncResponse = await fetch(`${("TURBOPACK compile-time value", "http://localhost:3001")}/api/initial-sync`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    accountId,
                    userId: userState
                })
            });
            if (syncResponse.ok) {
                console.log("[GMAIL CALLBACK] Initial sync request successful");
            } else {
                console.error("[GMAIL CALLBACK] Initial sync request failed:", await syncResponse.text());
            }
        } catch (syncError) {
            console.error("[GMAIL CALLBACK] Error requesting initial sync:", syncError);
        }
        console.log("[GMAIL CALLBACK] Redirecting to mail page...");
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].redirect(new URL("/mail?success=true", req.url));
    } catch (error) {
        console.error("[GMAIL CALLBACK] Error in Gmail callback:", error);
        if (error instanceof Error) {
            console.error("[GMAIL CALLBACK] Error details:", {
                message: error.message,
                stack: error.stack
            });
        }
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].redirect(new URL("/mail?error=callback_failed", req.url));
    }
};
}}),

};

//# sourceMappingURL=%5Broot%20of%20the%20server%5D__32a7410c._.js.map